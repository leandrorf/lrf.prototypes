@model OAuthDoZero.Server.ViewModels.ConsentViewModel
@{
    ViewData["Title"] = "Autoriza√ß√£o";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="card">
    <h2>üîê Autorizar Aplica√ß√£o</h2>

    @if (!string.IsNullOrEmpty(TempData["ErrorMessage"] as string))
    {
        <div class="alert alert-error">
            @TempData["ErrorMessage"]
        </div>
    }

    <div class="client-info">
        <h3>üì± @Model.ClientName</h3>
        <p><strong>ID da Aplica√ß√£o:</strong> @Model.ClientId</p>
        <p><strong>Usu√°rio:</strong> @ViewBag.Username</p>
        <p>Esta aplica√ß√£o est√° solicitando acesso √†s seguintes informa√ß√µes da sua conta:</p>
    </div>

    <form method="post" asp-action="Consent">
        <input type="hidden" asp-for="ClientId" />
        <input type="hidden" asp-for="RedirectUri" />
        <input type="hidden" asp-for="ResponseType" />
        <input type="hidden" asp-for="State" />
        <input type="hidden" asp-for="CodeChallenge" />
        <input type="hidden" asp-for="CodeChallengeMethod" />

        <div class="scope-list">
            <h3>üéØ Permiss√µes Solicitadas</h3>
            
            @for (int i = 0; i < Model.Scopes.Count; i++)
            {
                var scope = Model.Scopes[i];
                var isRequired = scope == "openid"; // OpenID √© sempre obrigat√≥rio
                
                <div class="scope-item @(isRequired ? "required" : "")">
                    <label>
                        <input type="hidden" asp-for="Scopes[i]" value="@scope" />
                        <input type="checkbox" 
                               name="SelectedScopes" 
                               value="@scope" 
                               @(isRequired ? "checked disabled" : "checked") />
                        <span class="scope-name">@GetScopeName(scope)</span>
                    </label>
                    <div class="scope-description">
                        @GetScopeDescription(scope)
                    </div>
                </div>
            }
        </div>

        <div class="form-group">
            <button type="submit" name="action" value="allow" class="btn">
                ‚úÖ Autorizar Acesso
            </button>
            
            <button type="submit" name="action" value="deny" class="btn btn-secondary">
                ‚ùå Negar Acesso
            </button>
        </div>
    </form>

    <div style="margin-top: 30px; padding: 15px; background: #f0f8ff; border-radius: 8px; border-left: 4px solid #0066cc;">
        <h4 style="margin-bottom: 10px; color: #0066cc;">üõ°Ô∏è Sobre suas informa√ß√µes</h4>
        <p style="margin-bottom: 8px; color: #333; font-size: 14px;">‚Ä¢ Suas credenciais de login n√£o ser√£o compartilhadas com a aplica√ß√£o</p>
        <p style="margin-bottom: 8px; color: #333; font-size: 14px;">‚Ä¢ Voc√™ pode revogar essas permiss√µes a qualquer momento</p>
        <p style="margin-bottom: 0; color: #333; font-size: 14px;">‚Ä¢ A aplica√ß√£o s√≥ ter√° acesso aos dados que voc√™ autorizar</p>
    </div>
</div>

@functions {
    string GetScopeName(string scope)
    {
        return scope switch
        {
            "openid" => "üÜî Identidade OpenID",
            "profile" => "üë§ Informa√ß√µes do Perfil",
            "email" => "üìß Endere√ßo de Email",
            "phone" => "üì± N√∫mero de Telefone",
            "address" => "üìç Endere√ßo",
            "offline_access" => "üîÑ Acesso Offline",
            _ => $"üîß {scope.ToUpper()}"
        };
    }

    string GetScopeDescription(string scope)
    {
        return scope switch
        {
            "openid" => "Permite que a aplica√ß√£o confirme sua identidade (obrigat√≥rio)",
            "profile" => "Acesso ao seu nome, nome de usu√°rio e outras informa√ß√µes b√°sicas do perfil",
            "email" => "Acesso ao seu endere√ßo de email principal",
            "phone" => "Acesso ao seu n√∫mero de telefone",
            "address" => "Acesso √†s suas informa√ß√µes de endere√ßo",
            "offline_access" => "Permite que a aplica√ß√£o acesse seus dados mesmo quando voc√™ n√£o estiver online",
            _ => $"Acesso aos recursos relacionados a {scope}"
        };
    }
}